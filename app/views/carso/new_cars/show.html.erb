<%
  max_price_e = @car.equipments.where(hide:0).order(price: :desc).first
  if (@car.discount_count(max_price_e) + @region_discount) < max_price_e.price*4/10
    max_discount_e = @car.discount_count(max_price_e) + @region_discount
  else
    max_discount_e = max_price_e.price*4/10
  end

  if (@car.discount_count + @region_discount) < @car.equipments.where(hide:0).minimum(:price)*4/10
    min_discount_e = @car.discount_count + @region_discount
  else
    min_discount_e = @car.equipments.where(hide:0).minimum(:price)*4/10
  end
  min_price = @car.equipments.where(hide:false).minimum(:price) - max_discount_e
%>
<%
  region = false
  unless @current_region.id == 57
    region = true
  end

  t_mos = "–ö—É–ø–∏—Ç—å #{@car.russian_name} #{@car.old ? (Time.current - 2.year).year.to_s : (Time.current - 1.year).year.to_s}-#{@car.old ? (Time.current - 1.year).year.to_s : Time.current.year.to_s} —É –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –¥–∏–ª–µ—Ä–∞ –≤ #{@current_region.sklon3} üöó  –Ω–æ–≤—ã–π #{@car.menutitle} ‚Äî –∞–≤—Ç–æ—Å–∞–ª–æ–Ω ¬´–ê–≤–∏–º–æ—Ç–æ—Ä—Å¬ª"
  t_reg = "–ö—É–ø–∏—Ç—å #{@car.russian_name} –≤ #{@current_region.sklon3} üöó —Ü–µ–Ω–∞ –Ω–∞ #{'–Ω–æ–≤—ã–π' unless @car.old} #{@car.menutitle} #{@car.old ? (Time.current - 1.year).year.to_s : Time.current.year.to_s} —É –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –¥–∏–ª–µ—Ä–∞ ‚Äî –∞–≤—Ç–æ—Å–∞–ª–æ–Ω ¬´–ê–≤–∏–º–æ—Ç–æ—Ä—Å¬ª"

  d_mos = "‚ùó –ì—Ä–∞–Ω–¥–∏–æ–∑–Ω–∞—è —Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∞ –Ω–æ–≤—ã—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π #{@car.menutitle} #{@car.old ? (Time.current - 2.year).year.to_s : (Time.current - 1.year).year.to_s} - #{@car.old ? (Time.current - 1.year).year.to_s : Time.current.year.to_s} –≥–æ–¥–∞ –≤ #{@current_region.sklon3}! üöò –í—Å–µ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ –≤ –Ω–∞–ª–∏—á–∏–∏ —É –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –¥–∏–ª–µ—Ä–∞! ‚ùó –°–∫–∏–¥–∫–∞ –Ω–∞ #{@car.russian_name} –¥–æ #{number_with_delimiter(max_discount_e,delimeter:' ')} —Ä—É–±. ‚úÖ –ö—Ä–µ–¥–∏—Ç –æ—Ç 1,9%! üéÅ ‚Äî –∞–≤—Ç–æ—Å–∞–ª–æ–Ω ¬´–ê–≤–∏–º–æ—Ç–æ—Ä—Å¬ª ‚òéÔ∏è 8 (800) 707-53-51."
  d_reg = "‚ùóÔ∏è–ì—Ä–∞–Ω–¥–∏–æ–∑–Ω–∞—è —Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∞ –Ω–æ–≤—ã—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π #{@car.menutitle} #{@car.old ? (Time.current - 2.year).year.to_s : (Time.current - 1.year).year.to_s} - #{@car.old ? (Time.current - 1.year).year.to_s : Time.current.year.to_s} –≥–æ–¥–∞! üöò –í—Å–µ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ –≤ –Ω–∞–ª–∏—á–∏–∏ —É –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –¥–∏–ª–µ—Ä–∞ –≤ #{@current_region.sklon3}!‚ùóÔ∏è –°–∫–∏–¥–∫–∞ –Ω–∞ #{@car.russian_name} –¥–æ #{number_with_delimiter(max_discount_e,delimeter:' ')} —Ä—É–±. ‚úÖ –ö—Ä–µ–¥–∏—Ç –æ—Ç 1,9%! üéÅ ‚Äî –∞–≤—Ç–æ—Å–∞–ª–æ–Ω ¬´–ê–≤–∏–º–æ—Ç–æ—Ä—Å¬ª ‚òéÔ∏è 8 (800) 707-53-51."

  o_mos = "–ö—É–ø–∏—Ç—å #{'–Ω–æ–≤—ã–π' unless @car.old} #{@car.russian_name} –≤ #{@current_region.sklon3}. –°–∫–∏–¥–∫–∞ –¥–æ #{number_with_delimiter(max_discount_e,delimeter:' ')} —Ä—É–±–ª–µ–π! –≠–∫—Å–ø—Ä–µ—Å—Å –∫—Ä–µ–¥–∏—Ç –æ—Ç 1.9%, –†–∞—Å—Å—Ä–æ—á–∫–∞ 0%, Trade-in. –ü—Ä–æ–¥–∞–∂–∞ #{@car.menutitle} #{@car.old ? (Time.current - 2.year).year.to_s : (Time.current - 1.year).year.to_s + '-' + Time.current.year.to_s} –≥–æ–¥–∞, –≤—Å–µ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ –≤ –Ω–∞–ª–∏—á–∏–∏ —É –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –¥–∏–ª–µ—Ä–∞ ‚Äî –∞–≤—Ç–æ—Å–∞–ª–æ–Ω ¬´–ê–≤–∏–º–æ—Ç–æ—Ä—Å¬ª"
  o_reg = "–ü—Ä–æ–¥–∞–∂–∞ #{@car.russian_name} –≤ #{@current_region.sklon3}. –°–∫–∏–¥–∫–∞ –¥–æ #{number_with_delimiter(max_discount_e,delimeter:' ')} —Ä—É–±–ª–µ–π! –≠–∫—Å–ø—Ä–µ—Å—Å –∫—Ä–µ–¥–∏—Ç 1,9%, –†–∞—Å—Å—Ä–æ—á–∫–∞ 0%, trade-in. #{'–ù–æ–≤—ã–π ' unless @car.old}#{@car.menutitle} #{@car.old ? (Time.current - 2.year).year.to_s : (Time.current - 1.year).year.to_s + '-' + Time.current.year.to_s} –≤—Å–µ—Ö –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–π —É –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –¥–∏–ª–µ—Ä–∞ ‚Äî –∞–≤—Ç–æ—Å–∞–ª–æ–Ω ¬´–ê–≤–∏–º–æ—Ç–æ—Ä—Å¬ª"

  if !region
    provide :title,t_mos
    provide :description,d_mos
    ogdesc = o_mos
  else
    provide :title,t_reg
    provide :description,d_reg
    ogdesc = o_reg
  end

  if @car.colors[0].present?
    pimage = @car.colors[0].url
  end

  provide :og_tags,"<meta property='og:type' content='article'>
  <meta property='og:site_name' content='–ê–≤–∏–º–æ—Ç–æ—Ä—Å'>
  <meta property='og:url' content='#{request.original_url}'>
  <meta property='og:title' content='#{@car.name}'>
  <meta property='og:description' content='#{ogdesc}'>
  <meta property='og:locale' content='ru_RU'>
  <meta property='og:image' content='#{pimage}'>".html_safe

%>

<%
  if @car.colors.length > 2
    colors_swaped = @car.colors.swap(0,1)
    color_options_swaped =  @car.color_options.swap(0,1)
  else
    colors_swaped = @car.colors
    color_options_swaped = @car.color_options
  end
%>

<% if @car.archive
     if @car.url.include? '-old'
       model = @car.url[0...-4]
     else
       model = @car.url
     end

     if UsedCar.used_cars.where(brand_id: @car.brand_id, url: model).present?
       name = @car.menutitle
     else
       name = @car.brand.title
     end
   end
%>






<section class="main-item">
  <div class="main-item-wrap">
    <div class="avt_nc">
      <% car_count_arr = [] %>
      <% equipments = @equipments.limit(10).shuffle %>
      <% equipments.each do |e| %>
        <% car_count = e.id % 3 %>
        <% car_count = 2 if car_count < 2 %>
        <% car_count_arr.push(car_count) %>
      <% end %>
      –í¬†–Ω–∞–ª–∏—á–∏–∏:&nbsp;<b><%= car_count_arr.sum %></b>
    </div>
    <div class="main-item-color">
      <div class="singlecar__colors">
        <ul class="colors-list">
          <% color_options_swaped.each_with_index do |c,index| %>
            <li class="color <% if index == 1 %>color--choosed<% end %>" data-action="show-color" style="background-color: <%= c['color'] %>; background: <%= c['color2'] if c['color2'].present? %>;"
                data-disable-hover="false" title="<%= c['colorname'] %>" data-color_index="<%= index %>">
            </li>
          <% end %>
        </ul>
      </div>
    </div>
      <div class="main-img img-comp-container" data-content="car-colors-list">
      <% colors_swaped[0..1].each_with_index do |c,index| %>
        <div class="img-comp-img">
          <%= image_tag "#{c.largecard.url}",class:'', alt:'', itemprop:'image', data:{:image_index=>index} %>
        </div>
      <% end %>
      <% if colors_swaped[2..-1].present? %>
        <% colors_swaped[2..-1].each_with_index do |c,index| %>
          <% index = index + 2 %>
          <div class="img-comp-img">
            <%#= image_tag 'blank.png',class:'', alt:'', data:{:altsrc=>"#{c.largecard.url}",:image_index=>index} %>
            <%= image_tag c.largecard.url, class:'', alt:'', data:{:image_index=>index} %>
          </div>
        <% end %>
      <% end %>
    </div>
    <div class="main-brand-model">
      <div class="vk_mp"></div>
      <div class="vk_mp_mn">
        <% unless !@car.available %>
        <a href="#compl_t" rel="nofollow" data-role="page-navigation-link" class="main-model-menu-item">–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ –∏ —Ü–µ–Ω—ã</a><% end %>
        <a href="#car-features" rel="nofollow" data-role="page-navigation-link" class="main-model-menu-item">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</a>
        <% unless !@car.available %><a href="#filter_list" rel="nofollow" data-role="page-navigation-link" class="main-model-menu-item">–ê–≤—Ç–æ–º–æ–±–∏–ª–∏ –≤ –Ω–∞–ª–∏—á–∏–∏</a><% end %>
        <% if @car.description.present? && @car.description['text_lower'].present? %>
        <% end %>
        <% if @car.images.present? %>
        <a href="#photo_car" rel="nofollow" class="main-model-menu-item">–§–æ—Ç–æ –∏¬†–≤–∏–¥–µ–æ</a><% end %>
      </div>
      <div class="main-brand-name"><%= @car.brand.title %></div>
      <div class="main-model-name"><%= @car.name %></div>
      <div class="main-price">
        <div class="main-price-item">



          <div class="main-price-discount"><%= number_with_delimiter(@car.count_min_price(@region_discount), delimiter: " ") %> ‚ÇΩ</div>
          <div class="main-price-month"><span class="main-price-month_green"><% snc_price = min_price %><%= number_with_delimiter(count_price(snc_price,PERCENT,MONTH), delimiter: " ") %> ‚ÇΩ</span>/–º–µ—Å
          </div>
        </div>
        <div class="main-price-item">
          <div class="main-price-benefit">
            <div class="main-price-benefit_title">–í—ã–≥–æ–¥–∞ –≤ –∫—Ä–µ–¥–∏—Ç</div>
            <div class="main-price-benefit_cost"><%= number_with_delimiter(max_discount_e,delimeter:' ') %> ‚ÇΩ</div>
          </div>
        </div>
      </div>
      <div class="main-spec">
        <div class="main-spec-item">
          <div class="main-spec-img engine"></div>
          <div class="main-spec-wrap">
            <div class="main-spec-title"><%= @car.specifications.joins(:equipment).where('`equipment`.`hide` = 0').maximum(:power) %> –ª/c</div>
            <div class="main-spec-text">–ú–æ—â–Ω–æ—Å—Ç—å –¥–≤–∏–≥–∞—Ç–µ–ª—è</div>
          </div>
        </div>
        <% min_acc = @car.specifications.joins(:equipment).where('`equipment`.`hide` = 0').minimum(:acceleration) %>
        <% if min_acc.present? %>
          <div class="main-spec-item">
            <div class="main-spec-img speed"></div>
            <div class="main-spec-wrap">
              <div class="main-spec-title"><%= @car.specifications.joins(:equipment).where('`equipment`.`hide` = 0').minimum(:acceleration).round(1) %> —Å</div>
              <div class="main-spec-text">–†–∞–∑–≥–æ–Ω –¥–æ 100 –∫–º/—á</div>
            </div>
          </div>
        <% end %>
        <%
          min_fh = @car.specifications.joins(:equipment).where('`equipment`.`hide` = 0').minimum(:fuelhigh)
          min_fc = @car.specifications.joins(:equipment).where('`equipment`.`hide` = 0').minimum(:fuelcity)
          min_fm = @car.specifications.joins(:equipment).where('`equipment`.`hide` = 0').minimum(:fuelmix)
          unless min_fc.nil? || min_fh.nil? || min_fm.nil?

            if (min_fc.nil? || min_fh.nil?) && min_fm.present?
              fuel = min_fm.round(1)
            else
              fuel = "#{min_fh.round(1)}"
            end
        %>
            <div class="main-spec-item">
              <div class="main-spec-img fuel"></div>
              <div class="main-spec-wrap">
                <div class="main-spec-title"><%= fuel %> –ª</div>
                <div class="main-spec-text">–†–∞—Å—Ö–æ–¥ –Ω–∞ 100–∫–º</div>
              </div>
          <% end %>
      </div>
    </div>
    </div>













    <section class="main-offer">
      <section class="main-offer-container">
        <div class="main-offer-title">–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –ø–æ–∫—É–ø–∫—É –≤ –∫—Ä–µ–¥–∏—Ç</div>
        <div class="main-offer-text">—Å–∫–∏–¥–∫–∞ –¥–æ <%= number_with_delimiter(max_discount_e,delimeter:' ') %> ‚ÇΩ / –ö–∞—Å–∫–æ –≤ –ø–æ–¥–∞—Ä–æ–∫ —Ä–∞—Å—Å—Ä–æ—á–∫–∞ 0%  /  –∫—Ä–µ–¥–∏—Ç: 1.9% </div>


        <%= form_for Ticket.new,url: {action:"create",controller:"tickets" },remote:true,validate:true,:html => {:class => "form",:name=>"newcarreq"},:namespace => "newcarreq" do |f| %>
          <%= hidden_field_tag 'ticket[other][model]',@car.id, id:'newcarreq_ticket_other_model' %>
          <%= f.hidden_field :form_name, value:"express" %>
          <div class="main-offer-form">
            <%= f.text_field :name,class:"input main-offer-form_input",placeholder:"–í–∞—à–µ –∏–º—è" %>
          </div>
          <div class="main-offer-form">
            <%= f.phone_field :phone,class:"input main-offer-form_input",data:{:role=>"phone"},placeholder:"–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞"  %>
          </div>
          <%= f.button class: "button main-offer-button_item" do %><span>–ü–æ–ª—É—á–∏—Ç—å —É—Å–ª–æ–≤–∏—è</span><% end %>
        <% end %>
        <div class="main-offer-action">–ê–∫—Ü–∏—è –¥–æ <%= l(SALE_DATE, format: :next_monday) %></div>
        <div class="main-offer-accept">–ù–∞–∂–∏–º–∞—è –Ω–∞ –∫–Ω–æ–ø–∫—É ‚Äú–ü–æ–ª—É—á–∏—Ç—å —É—Å–ª–æ–≤–∏—è‚Äù –í—ã –¥–∞–µ—Ç–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–≤–æ–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</div>
      </section>
    </section>



  </div>
</section>
<section class="main-model-menu">


  <div class="main-model-menu-list">
    <% unless !@car.available %>
      <a href="#compl_t" rel="nofollow" data-role="page-navigation-link" class="main-model-menu-item">–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ –∏ —Ü–µ–Ω—ã</a><% end %>
    <a href="#car-features" rel="nofollow" data-role="page-navigation-link" class="main-model-menu-item">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</a>
    <% unless !@car.available %><a href="#filter_list" rel="nofollow" data-role="page-navigation-link" class="main-model-menu-item">–ê–≤—Ç–æ–º–æ–±–∏–ª–∏ –≤ –Ω–∞–ª–∏—á–∏–∏</a><% end %>
    <% if @car.description.present? && @car.description['text_lower'].present? %>
    <% end %>
    <% if @car.images.present? %>
      <a href="#photo_car" rel="nofollow" class="main-model-menu-item">–§–æ—Ç–æ –∏¬†–≤–∏–¥–µ–æ</a><% end %>
  </div>

</section>
<section class="main-gifts">
  <section class="main-gifts-cont">
    <div class="main-gifts-item">
      <div class="main-gifts-img umbrella">

      </div>
      <div class="main-gifts-title snowflake">
        –ö–∞—Å–∫–æ
      </div>
      <div class="main-gifts-text train">
        –ø–æ–∫—É–ø–∞—Ç–µ–ª—é –≤ –ø–æ–¥–∞—Ä–æ–∫
      </div>
    </div>
    <div class="main-gifts-item">
      <div class="main-gifts-img snowflake">

      </div>
      <div class="main-gifts-title">
        –ó–∏–º–Ω—è—è —Ä–µ–∑–∏–Ω–∞
      </div>
      <div class="main-gifts-text">
        –≤ –ø–æ–¥–∞—Ä–æ–∫ —Å –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–º
      </div>
    </div>
    <div class="main-gifts-item">
      <div class="main-gifts-img train">

      </div>
      <div class="main-gifts-title">
        –û–ø–ª–∞—Ç–∞ –ø—Ä–æ–µ–∑–¥–∞
      </div>
      <div class="main-gifts-text">
        –ø–æ–∫—É–ø–∞—Ç–µ–ª—è –¥–æ –∞–≤—Ç–æ—Å–∞–ª–æ–Ω–∞
      </div>
    </div>
  </section>
</section>

<section class="main-salon">
  <section class="main-title-wrap">
    <div class="main-title">
      <div class="main-title-text">–í —Å–∞–ª–æ–Ω–µ</div>
    </div>
  </section>

  <div class="main-salon-gallery">
      <% @car.images_available.each do |image|%>
        <%= link_to image.url,class:'photo-link', data:{:fancybox => 'car-exterior'} do %>
        <div class="main-salon-gallery-wrap">
            <%= image_tag image.thumb.url, alt: '' %>
      </div>
        <% end %>
      <% end %>
   </div>












</section>




<section class="main-equip">
<% unless !@car.available %>
  <%# unless @car.archive %>
  <div class="complectation">

    <div class="main-title" id="compl_t">
      <div class="main-title-text">–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ –∏ —Ü–µ–Ω—ã</div>
    </div>


    <div class="table-main">
      <% spec = Specification.select('specifications.*,MIN(equipment.price) AS min_price')
          .joins(:equipment)
          .where('`specifications`.`new_car_id` = ?', @car.id).where('`equipment`.`hide` = 0').group('specifications.id').order('min_price') %>
      <table class="table">
        <tbody>
        <% spec.each_with_index do |cs,index_spec| %>
          <tr class="compl_gr_title"><td><div><% if cs.volume.present? %><%= "#{(cs.volume / 1000.to_f).round(1)} –ª. #{cs.drive == '–ü–æ–ª–Ω—ã–π' ? '4WD' : '2WD'} "%> <% end %> <% "#{cs.shorttransmission}" %></div></td></tr>
          <% cs.equipment.where('`equipment`.`hide` = 0').order(:price).each_with_index do |e,index| %>
            <%
              real_discount = @car.discount_count(e) + @region_discount
              if (@car.discount_count(e) + @region_discount) < e.price*4/10
                max_discount = @car.discount_count(e) + @region_discount
              else
                max_discount = e.price*4/10
              end
            %>

            <tr class="tr" data-action="show-table-row-description" data-url="<%= row_description_path(@brand.url,@car.url,e.id) %>">
              <th class="">
                <div>
                 <span><%= e.equipment_description.name %> <%= e.suffix %></span>
                 <span class="mn_s">
                     <b data-role="discount_price" class="tableprice" data-real-price="<%= (e.price - real_discount) %>"><%#= number_with_delimiter(e.price - max_discount,delimiter: ' ') %><%#= (e.price - real_discount) %><%= number_with_delimiter(e.price - real_discount,delimiter: ' ') %> ‚ÇΩ</b>
                     <%= e.specification.power %> –ª.—Å, <%= e.specification.shorttransmission %></span><i></i>
                </div>
                <div class="vgdm_dv">
                  <span class="vgdm_p">–í—ã–≥–æ–¥–∞ –≤ –∫—Ä–µ–¥–∏—Ç <b><%= number_with_delimiter(max_discount_e,delimeter:' ') %> ‚ÇΩ</b></span>
                  <a href="#" class="main-equip-button_item" data-show-new-ajax="car-credit-modal" data-eq_id="<%= e.id %>" rel="nofollow">–ö—É–ø–∏—Ç—å –≤ –∫—Ä–µ–¥–∏—Ç</a>
                </div>
              </th>
              <td class="mn kpp"><%= e.specification.transmission.gsub('–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è','–ú–µ—Ö–∞–Ω–∏–∫–∞').gsub('5-—Å—Ç—É–ø–µ–Ω—á–∞—Ç–∞—è –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è','–ú–µ—Ö–∞–Ω–∏–∫–∞').gsub('5MT','').gsub('6–ú–¢','').gsub('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è','–ê–≤—Ç–æ–º–∞—Ç').gsub('5-—Å—Ç—É–ø–µ–Ω—á–∞—Ç–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è','–ê–≤—Ç–æ–º–∞—Ç').gsub('4AT','') %> (<%= e.specification.shorttransmission %>)</td>
              <td class="mn"><% if e.specification.volume.present? %><%= (e.specification.volume / 1000.to_f).round(1) %><% end %></td>
              <td class="mn"><% if e.specification.power.present? %><%= e.specification.power %><% end %></td>
              <td class="mn compl-price">
                <span class="tablepricesale" data-role="base_price"><%= number_with_delimiter(e.price,delimiter: ' ') %></span> ‚ÇΩ
              </td>
              <td style="display: none">
                <span class="tablepricediscount" data-role="discount_sale" data-real-discount="<%=real_discount %>"><%= number_with_delimiter(max_discount,delimiter: ' ') %></span>
              </td>
              <td class="compl-price-discount">
                <span data-role="discount_price" class="tableprice" data-real-price="<%= (e.price - real_discount) %>"><%#= number_with_delimiter(e.price - max_discount,delimiter: ' ') %><%#= (e.price - real_discount) %><%= number_with_delimiter(e.price - real_discount,delimiter: ' ') %></span> ‚ÇΩ
              </td>
              <td class=""><a href="#" class="but_traid-in" data-show-new-ajax="car-details-modal" data-eq_id="<%= e.id %>" rel="nofollow">Trade-in</a></td>
              <td class="cr_ord">
                <a href="#" class="main-equip-button_item" data-show-new-ajax="car-credit-modal" data-eq_id="<%= e.id %>" rel="nofollow">–ö—É–ø–∏—Ç—å –≤ –∫—Ä–µ–¥–∏—Ç</a></td>
              <%
                e_name = e.equipment_description.name.parameterize
              %>
            </tr>
            <%= '<!-- noindex -->'.html_safe if region %>
            <tr class="compl-description" data-role="table-row-description">
              <td colspan="12">
                <div class="main-equip-pop show" id='equipment_<%= e.id %>_description'>
                  <%# if index == 0 && index_spec == 0%>
                  <% @equipment = e %>
                  <%= render partial:'carso/new_cars/compl_description_content' %>
                  <%# end %>
                </div>
              </td>
            </tr>
            <tr class="tbm"><td></td></tr>
            <%= '<!--/ noindex -->'.html_safe if region %>
          <% end %>
        <% end %>
        </tbody>
      </table>

    </div>
  </div>
  <%# end %>
<% end %>
<%#= render 'partials/carso/tradein_form' %>
</section>

<% cards = EquipmentDescription
    .joins(:equipments)
    .select('MIN(price) AS price,`equipment_descriptions`.`name`,`equipment_descriptions`.`description`, `equipment_descriptions`.`id`,`equipment_descriptions`.`new_car_id`, MIN(`equipment`.`id`) AS eq_id,`equipment_descriptions`.`compare`,`equipment_descriptions`.`comparedesc`')
    .where('`equipment_descriptions`.`new_car_id` = ?', @car.id).where('`equipment`.`hide` = 0')
    .group('`equipment`.`equipment_description_id`')
    .order('price ASC')
%>



<section class="main-compare">
  <% prev_compl = '' %>
  <% prev_compl_params = [] %>


  <% cards.each_with_index do |e, index| %>
    <% compl_params = [] %>
    <% doc = Nokogiri::HTML(e.description) %>
    <% doc.css('li').each do |tag| %>
      <% compl_params.push(tag.content) %>
    <% end %>
  <div class="main-compare-cont">
    <div class="main-compare-item">
      <div class="main-compare-wrap">
        <div class="main-compare-img">
          <% c = e.new_car.colors.swap(0,1) %>
          <% if index < c.length
               ind = index
             else
               ind = 0
             end
          %>
          <% if e.comparedesc %>
              <img src="<%= e.compare[0].large.url %>" alt="<%= e.comparedesc[0] %>">
          <% end %>
        </div>
        <div class="main-compare-adittion-wrap">
          <div class="main-compare-addition">
            <%= prev_compl == '' ? '–ë–∞–∑–æ–≤–∞—è –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è' : '–í –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ ' + prev_compl %>
          </div>
          <div class="main-compare-title"><%= e.name %></div>
          <div class="main-compare-price-credit">–í –∫—Ä–µ–¥–∏—Ç</div>
          <div class="main-compare-price">
            <div class="main-compare-price-wrap">
              <div class="main-compare-price-title"><% snc_price = e.equipments.where(hide: 0).minimum(:price) - max_discount_e %><%= number_with_delimiter(count_price(snc_price,PERCENT,MONTH), delimiter: " ") %> ‚ÇΩ/–º–µ—Å</div>
              <button class="main-button"></button>
            </div>
          </div>
        </div>
      </div>
      <div class="main-compare-scroll scroll">
        <div class="main-scroll-bg"></div>


        <% (compl_params - prev_compl_params).each do |p| %>
          <div class="main-compare-scroll_item"><%= p %></div>
        <% end %>

      </div>
    </div>
  </div>
    <% prev_compl_params = compl_params %>
    <% prev_compl = e.name %>
  <% end %>
</section>


<% if @car.images.present? %>
<section class="main-gallery">
  <div class="main-title-wrap">
    <div class="main-title">
      <div class="main-title-text">–§–æ—Ç–æ–≥–∞–ª–µ—Ä–µ—è</div>
    </div>
  </div>

  <div class="mg_fr-f">
    <% @car.images[1..-1].each do |image|%>
      <div class="main-gallery-item">
        <%= link_to image.large.url, itemprop:'url' ,class:'photo-link',data:{:fancybox => 'car-exterior'} do %>
          <%= image_tag image.thumb.url,alt: "#{@car.brand.title} #{@car.name}", class:'photo' %>
        <% end %>
      </div>
    <% end %>
  </div>
</section>
<% end %>



<section class="main-brand">
  <section class="main-title-wrap">
    <div class="main-title">
      <div class="main-title-text">
        –î—Ä—É–≥–∏–µ –º–æ–¥–µ–ª–∏ <%= @brand.title %>
      </div>
    </div>
  </section>
  <div class="main-brand-item-cont">
    <%= render partial:'new_cars/small_new_cars_model', collection: @brand.new_cars.where(hide: 0).where(archive: 0).where.not(id: @car.id).min_price_ordered.limit(6), :locals => {:show_brand => false,:credit_flag => true} %>

  </div>
</section>











<% content_for :rails_to_js_variables do %>
  <script>
      var COMPL_GROUPS = <%= @compl_groups %>;
      //  var COLOR_GROUPS = <%= @color_groups %>;
  </script>
<% end %>
<% content_for :additional_javascript do %>

  <script>
      carid = '<%= @car.id %>';
      car_url = '<%= @car.url %>';
      car_brand = '<%= @car.brand.url %>';
  </script>

  <script type="text/javascript">
      var _tmr = _tmr || [];
      _tmr.push({
          type: 'itemView',
          productid: '<%= @car.id %>',
          pagetype: 'product',
          list: '2',
          totalvalue: '<%= number_with_delimiter(@car.count_min_price(@region_discount), delimiter: "") %>'
      });
  </script>

<% end %>